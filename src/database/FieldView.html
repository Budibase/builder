<script>
import Dropdown from "../common/Dropdown.html";
import Textbox from "../common/Textbox.html";
import Button from "../common/Button.html";
import ErrorsBox from "../common/ErrorsBox.html";

import {cloneDeep, assign, keys, map} from "lodash/fp";
import {allTypes, validate} from "../common/core";

export let field;
export let allFields;
export let onFinished = () => {};

let errors = [];

//$:isValid = errors.length === 0;
$:clonedField = cloneDeep(field);
$:isNew = !!field && field.name.length === 0;

const save = () => {

    errors = validate.field(allFields)(clonedField);
    if(errors.length > 0) return;
    onFinished(
        assign(field)(clonedField)
    );
}

</script>

<div class="root">

    <ErrorsBox errors={errors} />

    {#if isNew}
    <Textbox label="Field Name" bind:text={clonedField.name} />
    {:else}
    <div style="font-weight: bold">{field.name}</div>
    {/if}

    <Textbox label="Label" bind:text={clonedField.label} />
    <Dropdown label="Type" bind:selected={clonedField.type} options={keys(allTypes)} />


    <div class="actions">
        <Button color="primary" on:click={save}>Save</Button>
        <Button color="secondary" on:click={() => onFinished(false)}>Cancel</Button>
    </div>



</div>

<style>

.actions {
    float:right;
    padding: 10px;
}



</style>